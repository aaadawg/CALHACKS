<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="A Chat-App">
    <meta name="author" content="Rohit Lalchandani">

    <title>CALHACKS Checkers</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet"> <!-- Bootstrap -->
    <link href="css/chessboard.css" rel="stylesheet"> <!-- Chessboard -->
    <link rel="stylesheet" type="text/css" href="css/sweetalert.css"> <!-- SweetAlertJS -->

    <!-- Padding for navbar -->
    <style>
/*      body { 
        padding-top: 65px; 
      }*/
    </style>
  </head>

  <body>

    <!-- Checkers Table -->
    <table id="chess_board" cellpadding="0" cellspacing="0">
    </table>

    <!-- Socket.io for messaging -->
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="js/sweetalert.min.js"></script>
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <!-- JQuery selectors -->
    <script>

        var board;

        function drawboard(board) {
            $("#chess_board").empty();
            for (var i = 0; i < board.length; i++) {
                $("#chess_board").append("<tr id='row" + i + "'>");
                for (var j = 0; j < board[i].length; j++) {
                    var elem = board[i][j];
                    if (elem == null) {
                        $("#row" + i).append("<td hasPiece='false' class='location' id=" + i + "-" + j + "></td>");
                    } else {
                        $("#row" + i).append("<td hasPiece='true' class='location' id='" + i + "-" + j + "'><a href='#' class='pawn " + elem.team + "'>&#9823;</a></td>");
                    }   
                }
                $("#chess_board").append("</tr>");
            }
        }

        var socket = io();

        socket.on('board', function(res) {
            board = JSON.parse(res);
            drawboard(board);
        })


        var selectedPiece;
        var hasMoved = false;
        var src;
        var hasSelectedPiece = false;

        $('table').on("click", ".location",function() {

            if (!hasSelectedPiece && !hasMoved) { // Selecting a piece

                src = $(this).attr('id').split("-"); // [x, y]
                var hasPiece = $(this).attr('hasPiece');
                var potentialPiece = board[src[0]][src[1]]; // we don't know if we can select this piece
                if (hasPiece === "true" && canSelect(potentialPiece)) {
                    selectedPiece = potentialPiece; // Get Piece from Board
                    hasSelectedPiece = true;
                }

            } else { // Executing a move

                var dest = $(this).attr('id').split("-");
                var move_status = canMove(selectedPiece, src, dest);
                if (move_status !== -1) { // we are at least moving
                    // Create New Board Object
                    board[dest[0]][dest[1]] = selectedPiece;
                    board[src[0]][src[1]] = null;
                    if (move_status === 1) {
                        board[(src[0] + dest[0])/2][(src[1] + dest[1])/2] = null;
                    }
                    drawboard(board);
                    hasMoved = true;
                }
                
            }

        });

    </script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.min.js"></script>
  </body>